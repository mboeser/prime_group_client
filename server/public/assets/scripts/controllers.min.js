/*! breakthrough 2016-01-21 */
myApp.controller("absentCtrl",["$scope","$http","DataService","$mdToast","$location",function(a,b,c,d,e){console.log("on admin absent controller--absentCtrl.js"),a.dataService=c,a.user={},a.date=a.dataService.getDate(),a.user=a.dataService.peopleData(),a.homework_sent=!1,void 0===a.dataService.peopleData()&&a.dataService.retrieveData().then(function(){a.user=a.dataService.peopleData()});var f="<md-checkbox ng-model='row.entity.excused' class='md-warn md-hue2' type='checkbox' name='excused' ng-change='grid.appScope.saveRow(row.entity)'></md-checkbox>",g="<md-checkbox ng-model='row.entity.homework_sent' class='md-warn md-hue2' type='checkbox' name='homework_sent'  ng-change='grid.appScope.saveRow(row.entity)'></md-checkbox>",h='<div class="ui-grid-cell-contents"  ng-click="grid.appScope.selectStudent(row.entity.id)">{{row.entity.id}}</div>';a.gridOptions={enableSorting:!0,rowEditWaitInterval:500,columnDefs:[{name:"id",field:"id",enableCellEdit:!1,cellTemplate:h},{name:"Teacher",field:"lastname",cellClass:"cell-default",enableCellEdit:!0},{name:"First Name",field:"student_firstname",cellClass:"cell-default",enableCellEdit:!0},{name:"Last Name",field:"student_lastname",cellClass:"cell-default",enableCellEdit:!0,sort:{direction:"asc"}},{name:"Phone 1",field:"phone1",enableCellEdit:!0,cellFilter:"tel"},{name:"Call Status",field:"contact_status",enableCellEdit:!0,editableCellTemplate:"ui-grid/dropdownEditor",editDropdownValueLabel:"contact_status",editDropdownOptionsArray:[{id:"Not Yet Called",contact_status:"Not Yet Called"},{id:"Reached",contact_status:"Reached"},{id:"Left Message",contact_status:"Left Message"}]},{name:"Homework Sent",field:"homework_sent",cellTemplate:g,enableCellEdit:!0},{name:"Excused",field:"excused",cellTemplate:f,enableCellEdit:!0},{name:"Attendance Notes",field:"attendance_notes",enableCellEdit:!0}],enableGridMenu:!0,enableSelectAll:!0,exporterCsvFilename:"myFile.csv",exporterPdfDefaultStyle:{fontSize:9},exporterPdfTableStyle:{margin:[30,30,30,30]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"red"},exporterPdfHeader:{text:"Breakthrough Twin Cities",style:"headerStyle"},exporterPdfFooter:function(a,b){return{text:a.toString()+" of "+b.toString(),style:"footerStyle"}},exporterPdfCustomFormatter:function(a){return a.styles.headerStyle={fontSize:22,bold:!0},a.styles.footerStyle={fontSize:10,bold:!0},a},exporterPdfOrientation:"portrait",exporterPdfPageSize:"LETTER",exporterPdfMaxGridWidth:500,exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location"))},a.gridOptions.data=a.dataService.getData(),a.saveRow=function(c){var d=b.put("/updateAbsent",c).then(function(b){a.editUserToast()});a.gridApi.rowEdit.setSavePromise(c,d)},a.gridOptions.onRegisterApi=function(b){a.gridApi=b,b.rowEdit.on.saveRow(a,a.saveRow)},a.selectStudent=function(c){b.get("/student",{params:{student:c}}).then(function(b){a.dataService.setStudent(b.data[0]),a.dataService.getStudent(),a.student=a.dataService.getStudent(),a.student.grade<9?e.path("/middleschool"):e.path("/highschool")})},a.editUserToast=function(){d.show(d.simple().content("Student Edited!"))}}]),myApp.controller("attendanceCtrl",["$scope","$http","$location","DataService","$mdToast","$document",function(a,b,c,d,e,f){console.log("on admin attendance controller--attendanceCtrl.js"),a.dataService=d,a.user={},a.date=a.dataService.getDate(),a.user=a.dataService.peopleData(),a.students=[],void 0===a.dataService.peopleData()&&a.dataService.retrieveData().then(function(){a.user=a.dataService.peopleData()}),a.getAttendance=function(){b.get("/attendance",{params:{date:a.date,who:a.dataService.getTeacher()}}).then(function(b){a.students=b.data})},a.putAttendance=function(){b.put("/attendance",a.students).then(function(b){a.showActionToast(),a.getAttendance()})},a.showActionToast=function(){var b=0,d=0;a.students.forEach(function(a){"absent"==a.attendance_status?b++:"present"==a.attendance_status&&d++});var f=angular.element(document.getElementById("attBtn")),g=e.simple().content("Absent: "+b+"\nPresent: "+d).action("OK").highlightAction(!1).hideDelay(2e3).parent(f).position("bottom");e.show(g).then(function(a){c.path("/dashboard")})},a.getAttendance()}]),myApp.controller("dashCtrl",["$scope","$http","$location","DataService","$filter",function(a,b,c,d,e){a.dataService=d,a.user={},a.date=a.dataService.getDate(),a.user=a.dataService.peopleData(),void 0===a.dataService.peopleData()&&a.dataService.retrieveData().then(function(){a.user=a.dataService.peopleData()}),a.prework={},a.absent={},a.getAbsences=function(){a.absentDate=e("date")(a.absent.date,"yyyy-MM-dd"),b.get("/absent",{params:{date:a.absentDate}}).then(function(b){a.dataService.setData(b.data),c.path("/absent")})},a.getPrework=function(){a.preworkDate=e("date")(a.prework.date,"yyyy-MM-dd"),b.get("/prework",{params:{date:a.preworkDate}}).then(function(b){a.dataService.setData(b.data),c.path("/prework")})},console.log("on admin dashboard controller--dashCtrl.js")}]),myApp.controller("preworkCtrl",["$scope","$http","$location","DataService","$mdToast","$filter",function(a,b,c,d,e,f){console.log("on admin prework controller--preworkCtrl.js"),a.dataService=d,a.user={},a.date=a.dataService.getDate(),a.user=a.dataService.peopleData(),console.log("$scope.dataService.peopleData",a.dataService.peopleData()),void 0===a.dataService.peopleData()&&a.dataService.retrieveData().then(function(){a.user=a.dataService.peopleData()});var g='<div class="ui-grid-cell-contents"  ng-click="grid.appScope.selectStudent(row.entity.id)">{{row.entity.id}}</div>';a.gridOptions={enableSorting:!0,rowEditWaitInterval:500,columnDefs:[{name:"id",field:"id",enableCellEdit:!1,cellTemplate:g},{name:"Teacher",field:"lastname",cellClass:"cell-default",enableCellEdit:!1},{name:"First Name",field:"student_firstname",cellClass:"cell-default",enableCellEdit:!1},{name:"Last Name",field:"student_lastname",cellClass:"cell-default",enableCellEdit:!1,sort:{direction:"asc"}},{name:"Phone 1",field:"phone1",enableCellEdit:!0,cellFilter:"tel"},{name:"Call Status",field:"contact_status",enableCellEdit:!0,editableCellTemplate:"ui-grid/dropdownEditor",editDropdownValueLabel:"contact_status",editDropdownOptionsArray:[{id:"Not Yet Called",contact_status:"Not Yet Called"},{id:"Reached",contact_status:"Reached"},{id:"Left Message",contact_status:"Left Message"}]},{name:"Administration Notes",field:"admin_notes",enableCellEdit:!0}],enableGridMenu:!0,enableSelectAll:!0,exporterCsvFilename:"myFile.csv",exporterPdfDefaultStyle:{fontSize:9},exporterPdfTableStyle:{margin:[30,30,30,30]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"red"},exporterPdfHeader:{text:"My Header",style:"headerStyle"},exporterPdfFooter:function(a,b){return{text:a.toString()+" of "+b.toString(),style:"footerStyle"}},exporterPdfCustomFormatter:function(a){return a.styles.headerStyle={fontSize:22,bold:!0},a.styles.footerStyle={fontSize:10,bold:!0},a},exporterPdfOrientation:"portrait",exporterPdfPageSize:"LETTER",exporterPdfMaxGridWidth:500,exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location"))},a.gridOptions.data=a.dataService.getData(),a.saveRow=function(c){var d=b.put("/adminPrework",c).then(function(b){a.editUserToast()});a.gridApi.rowEdit.setSavePromise(c,d)},a.gridOptions.onRegisterApi=function(b){a.gridApi=b,b.rowEdit.on.saveRow(a,a.saveRow)},a.selectStudent=function(d){b.get("/student",{params:{student:d}}).then(function(b){a.dataService.setStudent(b.data[0]),a.dataService.getStudent(),a.student=a.dataService.getStudent(),a.student.grade<9?c.path("/middleschool"):c.path("/highschool")})},a.editUserToast=function(){e.show(e.simple().content("Student Edited!"))}}]),myApp.filter("tel",function(){return function(a){if(!a)return"";var b=a.toString().trim().replace(/^\+/,"");if(b.match(/[^0-9]/))return a;var c,d;switch(b.length){case 12:c=b.slice(0,3),d=b.slice(4);break;case 10:c=b.slice(0,3),d=b.slice(3);break;case 13:return console.log("at 13"),b;default:return c=b.slice(0,3),d=b.slice(4),console.log(c),console.log(d),b}return d=d.slice(0,3)+"-"+d.slice(3),("("+c+") "+d).trim()}}),myApp.controller("studentACtrl",["$scope","$http","DataService","$mdToast",function(a,b,c,d){console.log("on student controller--studentCtrl.js"),a.dataService=c,a.user={},a.date=a.dataService.getDate(),a.user=a.dataService.peopleData(),a.student=a.dataService.getStudent(),void 0===a.dataService.peopleData()&&a.dataService.retrieveData().then(function(){a.user=a.dataService.peopleData()}),a.dropdown=["Not Yet Called","Reached","Left Message"],a.updateNotes=function(c,d){b.put("/updateStudent",{params:{column:c,value:d,id:a.student.id}}).then(function(){a.editUserToast(),a.setPrework()})},a.updateBus=function(c,d){b.put("/updateBus",{params:{column:c,value:d,id:a.student.id}}).then(function(){a.editUserToast(),a.setPrework()})},a.updateInfo=function(c,d){b.put("/updateStudentInfo",{params:{column:c,value:d,id:a.student.id}}).then(function(){a.editUserToast(),a.setPrework()})},a.setPrework=function(){var c=a.student.class_date.slice(0,10);b.get("/prework",{params:{date:c}}).then(function(b){a.dataService.setData(b.data)})},a.editUserToast=function(){d.show(d.simple().content("Student Edited!"))}}]),myApp.controller("teacherCtrl",["$scope","$http","$location","DataService",function(a,b,c,d){console.log("on admin teacher select controller--teacherCtrl.js"),a.dataService=d,a.user={},a.date=a.dataService.getDate(),a.user=a.dataService.peopleData(),void 0===a.dataService.peopleData()&&a.dataService.retrieveData().then(function(){a.user=a.dataService.peopleData()}),a.teachers=[],a.getTeachers=function(){b.get("/admin_attendance",{params:{date:a.date}}).then(function(b){a.teachers=b.data})},a.selectTeacher=function(b){a.dataService.setTeacher(b.teacher_email)},a.getTeachers()}]),myApp.controller("uploadCtrl",["$scope","$http","Upload","DataService","$mdToast",function(a,b,c,d,e){console.log("on admin upload controller--uploadCtrl.js"),a.dataService=d,a.user={},a.date=a.dataService.getDate(),a.user=a.dataService.peopleData(),void 0===a.dataService.peopleData()&&a.dataService.retrieveData().then(function(){a.user=a.dataService.peopleData()}),a.uploadStatus=!1,a.upload=function(b){console.log(b),c.upload({url:"/upload",data:{file:b}}).then(function(b){a.openToast(),console.log("Success "+b.config.data.file.name+"uploaded. Response: "+b.data)},function(a){console.log("Error status: "+a.status)},function(a){var b=parseInt(100*a.loaded/a.total);console.log("progress: "+b+"% "+a.config.data.file.name)})},a.download=function(){b.get("/download")},a.openToast=function(){e.show(e.simple().content("Upload Complete!"))}}]),myApp.controller("userCtrl",["$scope","$http","$location","DataService","$mdToast",function(a,b,c,d,e){console.log("on admin user controller--userCtrl.js"),a.dataService=d,a.user={},a.date=a.dataService.getDate(),a.user=a.dataService.peopleData(),void 0===a.dataService.peopleData()&&a.dataService.retrieveData().then(function(){a.user=a.dataService.peopleData()}),a.userList=[],a.newUser={},a.gridOptions={rowEditWaitInterval:500,columnDefs:[{name:"First Name",field:"firstname",width:"13%",enableSorting:!0,enableColumnResizing:!0,enableCellEdit:!0},{name:"Last Name",field:"lastname",width:"13%",enableCellEdit:!0},{name:"role",field:"role",minWidth:60,width:60,enableColumnResizing:!1,editableCellTemplate:"ui-grid/dropdownEditor",editDropdownValueLabel:"role",editDropdownOptionsArray:[{id:"admin",role:"Admin"},{id:"teacher",role:"Teacher"}]},{name:"Email",field:"email",width:"37%",enableCellEdit:!0},{name:" ",field:"id",cellClass:"delete-wrapper",enableSorting:!1,enableColumnMenu:!1,enableHiding:!1,enableColumnResizing:!1,cellTemplate:'<button style="margin-left: 40%; "class="delete-button" ng-click="grid.appScope.deleteUser(row.entity.email)">Delete</button>'}],enableGridMenu:!0,enableSelectAll:!0,exporterCsvFilename:"myFile.csv",exporterPdfDefaultStyle:{fontSize:9},exporterPdfTableStyle:{margin:[30,30,30,30]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"red"},exporterPdfHeader:{text:"My Header",style:"headerStyle"},exporterPdfFooter:function(a,b){return{text:a.toString()+" of "+b.toString(),style:"footerStyle"}},exporterPdfCustomFormatter:function(a){return a.styles.headerStyle={fontSize:22,bold:!0},a.styles.footerStyle={fontSize:10,bold:!0},a},exporterPdfOrientation:"portrait",exporterPdfPageSize:"LETTER",exporterPdfMaxGridWidth:500,exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location")),onRegisterApi:function(b){a.gridApi=b}},a.saveRow=function(c){var d=b.put("/roles",c).then(function(b){a.editUserToast()});a.gridApi.rowEdit.setSavePromise(c,d)},a.gridOptions.onRegisterApi=function(b){a.gridApi=b,b.rowEdit.on.saveRow(a,a.saveRow)},a.submitForm=function(){b.post("/roles",a.newUser).then(function(b){a.getUserList(),a.newUser={},a.addUserForm.$setPristine(),a.addUserForm.$setUntouched(),a.openToast()})},a.getUserList=function(){b.get("/roles").then(function(b){a.gridOptions.data=b.data})},a.updateUser=function(c){b.put("/roles",c).then(function(b){a.editUserToast(),a.getUserList()})},a.deleteUser=function(c){console.log(c),b["delete"]("/roles",{params:{deleteMe:c}}).then(function(b){a.deleteUserToast(),a.getUserList()})},a.openToast=function(){e.show(e.simple().content("User Added!"))},a.deleteUserToast=function(){e.show(e.simple().content("User Deleted!"))},a.editUserToast=function(){e.show(e.simple().content("User Edited!"))},a.getUserList()}]),myApp.controller("attendanceTCtrl",["$scope","$http","DataService","$mdToast","$location",function(a,b,c,d,e){console.log("on teacher attendance controller--attendanceTCtrl.js"),a.dataService=c,a.user={},a.date=a.dataService.getDate(),a.user=a.dataService.peopleData(),a.students=[],void 0===a.dataService.peopleData()?a.dataService.retrieveData().then(function(){a.user=a.dataService.peopleData(),a.getAttendance()}):console.log("Else statement right before get attendance"),a.getAttendance=function(){b.get("/attendance",{params:{date:a.date,who:a.user.emails[0].value}}).then(function(b){a.students=b.data})},a.putAttendance=function(){b.put("/attendance",a.students).then(function(b){a.showActionToast(),a.getAttendance()})},a.showActionToast=function(){var b=0,c=0;a.students.forEach(function(a){"absent"==a.attendance_status?b++:"present"==a.attendance_status&&c++});var f=angular.element(document.getElementById("attBtn")),g=d.simple().content("Absent: "+b+"\nPresent: "+c).action("OK").highlightAction(!1).hideDelay(2e3).parent(f).position("bottom");d.show(g).then(function(a){e.path("/dashboard")})},a.getAttendance()}]),myApp.controller("classCtrl",["$scope","$http","DataService","$location","$mdToast",function(a,b,c,d,e){console.log("on teacher class controller--classCtrl.js"),a.dataService=c,a.user={},a.date=a.dataService.getDate(),a.students=a.dataService.getData(),a.classdate=a.students[0].class_date.slice(0,10),a.student,a.user=a.dataService.peopleData(),void 0===a.dataService.peopleData()&&a.dataService.retrieveData().then(function(){a.user=a.dataService.peopleData()});var f='<div ng-if="row.entity.contact_status">{{row.entity.contact_status}}</div><div ng-if="!row.entity.contact_status">Not Yet Called</div>',g='<div class="ui-grid-cell-contents" ng-click="grid.appScope.selectStudent(row.entity.id)">{{row.entity.id}}</div>';a.gridOptions={enableSorting:!0,rowEditWaitInterval:500,columnDefs:[{name:"id",field:"id",enableCellEdit:!1,cellTemplate:g},{name:"First Name",field:"student_firstname",enableCellEdit:!1,cellClass:"cell-default"},{name:"Last Name",field:"student_lastname",enableCellEdit:!1,cellClass:"cell-default",sort:{direction:"asc"}},{name:"Phone 1",field:"phone1",enableCellEdit:!0,cellFilter:"tel"},{name:"Call Status",field:"contact_status",cellTemplate:f,enableCellEdit:!0,editableCellTemplate:"ui-grid/dropdownEditor",editDropdownValueLabel:"contact_status",editDropdownOptionsArray:[{id:"Not Yet Called",contact_status:"Not Yet Called"},{id:"Reached",contact_status:"Reached"},{id:"Left Message",contact_status:"Left Message"}]},{name:"Attendance Notes",field:"attendance_notes",enableCellEdit:!0}],enableGridMenu:!0,enableSelectAll:!0,exporterCsvFilename:"myFile.csv",exporterPdfDefaultStyle:{fontSize:9},exporterPdfTableStyle:{margin:[30,30,30,30]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"red"},exporterPdfHeader:{text:"My Header",style:"headerStyle"},exporterPdfFooter:function(a,b){return{text:a.toString()+" of "+b.toString(),style:"footerStyle"}},exporterPdfCustomFormatter:function(a){return a.styles.headerStyle={fontSize:22,bold:!0},a.styles.footerStyle={fontSize:10,bold:!0},a},exporterPdfOrientation:"portrait",exporterPdfPageSize:"LETTER",exporterPdfMaxGridWidth:500,exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location"))},a.gridOptions.data=a.dataService.getData(),a.saveRow=function(c){var d=b.put("/adminPrework",c).then(function(b){a.editUserToast()});a.gridApi.rowEdit.setSavePromise(c,d)},a.gridOptions.onRegisterApi=function(b){a.gridApi=b,b.rowEdit.on.saveRow(a,a.saveRow)},a.selectStudent=function(c){b.get("/student",{params:{student:c}}).then(function(b){a.dataService.setStudent(b.data[0]),a.dataService.getStudent(),a.student=a.dataService.getStudent(),a.student.grade<9?d.path("/middleschool"):d.path("/highschool")})},a.editUserToast=function(){e.show(e.simple().content("Student Edited!"))}}]),myApp.controller("dashTCtrl",["$scope","$http","DataService","$location",function(a,b,c,d){console.log("on teacher dash controller--dashTCtrl.js"),a.dataService=c,a.user={},a.date=a.dataService.getDate(),a.classes=[],a.user=a.dataService.peopleData(),void 0===a.dataService.peopleData()&&a.dataService.retrieveData().then(function(){a.user=a.dataService.peopleData()}),a.getClasses=function(){b.get("/teacher").then(function(b){for(var c=0;c<b.data.length;c++)a.classes.push(b.data[c].class_date.slice(0,10))})},a.getPrework=function(c){b.get("/teacher_prework",{params:{date:c}}).then(function(b){a.dataService.setData(b.data),d.path("/class")})},a.getAttendance=function(){b.get("/attendance",{params:{date:a.date,who:a.user}})},a.getClasses()}]),myApp.controller("navCtrl",["$scope","$http","DataService",function(a,b,c){a.dataService=c,a.date=a.dataService.getDate(),a.classToday=!1,a.dataService.getClasses().then(function(b){console.log("this is classes ",b);for(var c=0;c<b.length;c++)if(console.log("for loop",c),a.date==b[c])return a.classToday=!0})}]),myApp.controller("studentCtrl",["$scope","$http","DataService","$mdToast",function(a,b,c,d){console.log("on student controller--studentCtrl.js"),a.dataService=c,a.user={},a.date=a.dataService.getDate(),a.user=a.dataService.peopleData(),a.student=a.dataService.getStudent(),void 0===a.dataService.peopleData()&&a.dataService.retrieveData().then(function(){a.user=a.dataService.peopleData()}),a.dropdown=["Not Yet Called","Reached","Left Message"],a.updateNotes=function(c,d){b.put("/updateStudent",{params:{column:c,value:d,id:a.student.id}}).then(function(){a.editUserToast(),a.setPrework()})},a.updateBus=function(c,d){b.put("/updateBus",{params:{column:c,value:d,id:a.student.id}}).then(function(){a.editUserToast(),console.log("student data updated"),a.setPrework()})},a.updateInfo=function(c,d){b.put("/updateStudentInfo",{params:{column:c,value:d,id:a.student.id}}).then(function(){a.editUserToast(),a.setPrework()})},a.setPrework=function(){var c=a.student.class_date.slice(0,10);b.get("/teacher_prework",{params:{date:c}}).then(function(b){a.dataService.setData(b.data)})},a.editUserToast=function(){d.show(d.simple().content("Student Edited!"))}}]);